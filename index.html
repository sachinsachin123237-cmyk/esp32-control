<!DOCTYPE html>
<html>
<head>
    <title>Wheelchair Joystick</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.9.0/nipplejs.min.js"></script>
    <style>
        body { text-align:center; font-family:Arial; background:#f4f4f4; touch-action: none; overflow: hidden; }
        #joystick-zone { 
            width: 100%; height: 400px; background: #fff; 
            position: relative; margin: 20px 0; border-radius: 20px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }
        .info { font-size: 20px; font-weight: bold; color: #333; margin-top: 20px; }
        #status { color: #1976D2; }
    </style>
</head>
<body>
    <h1>ðŸ¦½ Wheelchair Remote Control</h1>
    <div class="info">Status: <span id="status">Connecting...</span></div>

    <div id="joystick-zone"></div>

    <script>
        const broker = 'wss://da5d5e6e407e495db2c68d35b34b405b.s1.eu.hivemq.cloud:8884/mqtt';
        const options = {
            username: 'wheel',
            password: 'Wheel123',
            clientId: 'web_joy_' + Math.random().toString(16).substr(2, 8)
        };

        const client = mqtt.connect(broker, options);
        const statusEl = document.getElementById('status');

        client.on('connect', () => { statusEl.innerText = "Connected - Use Joystick"; });

        // Initialize Virtual Joystick
        const manager = nipplejs.create({
            zone: document.getElementById('joystick-zone'),
            mode: 'static',
            position: { left: '50%', top: '50%' },
            color: '#1976D2',
            size: 200
        });

        let currentDir = "";

        manager.on('dir:up dir:down dir:left dir:right', (evt, data) => {
            let newDir = "";
            if (data.direction.angle === 'up') newDir = "JOY:F";
            else if (data.direction.angle === 'down') newDir = "JOY:B";
            else if (data.direction.angle === 'left') newDir = "JOY:L";
            else if (data.direction.angle === 'right') newDir = "JOY:R";

            if (newDir !== currentDir) {
                currentDir = newDir;
                client.publish('sachin/esp32/nav/control', currentDir);
            }
        });

        manager.on('end', () => {
            currentDir = "";
            client.publish('sachin/esp32/nav/control', 'STOP');
        });
    </script>
</body>
</html>
